#!/bin/bash
set -e
set -o pipefail


if [[ "$@" == "" ]]
then
    echo "Must supply dependency list to update"
    exit 1
fi

OPTIONS=()
DEPS=()

for ((i=1; i<=$#; i++))
do
    item="${!i}"
    if [[  "$item" =~ \-\- ]]; then
      OPTIONS+=("$item")
    else
      DEPS+=("$item")
    fi
done

# echo OPTIONS "$OPTIONS"

# make sure nothing extraneous exists
npm prune

# make sure everything else is up-to-date
npm install "$OPTIONS"

# remove the indicated deps
for i in "${DEPS[@]}"
do
  # echo Removing $i
	rm -rf "./node_modules/$i"
done

# remove the shrinkwrap file
rm -f npm-shrinkwrap.json

# install new versions of removed deps
npm install "$OPTIONS"

# create new shrinkwrap file
npm shrinkwrap
