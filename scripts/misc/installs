#!/bin/bash
set -e

if [[ "$IS_HEROKU" != "" || "$CI" != "" ]]; then
  # use buildpacks if HEROKU
  # CI skipp installs and expect specs dependent on installs to be in backendIntegration
  exit 0
fi

platform='unknown'
unamestr=`uname`

if [[ "$unamestr" == 'Linux' ]]; then
  #http://sharp.dimens.io/en/stable/install/
  curl -s https://raw.githubusercontent.com/lovell/sharp/master/preinstall.sh | sudo bash -
elif [[ "$unamestr" == 'Darwin' ]]; then
  #http://sharp.dimens.io/en/stable/install/
  if ! hash vips &> /dev/null || [[ $IS_HEROKU = 1 ]];then
    brew install homebrew/science/vips --with-imagemagick --with-webp
  fi
fi

exit 0
