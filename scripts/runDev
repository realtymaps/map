#!/bin/bash
set -e

export GULP_COLOR="--color"

for ((i=1; i<=$#; i++))
do
    case "${!i}" in
        --really-clean)
            export DO_CACHE_CLEAN=true
            DO_CLEAN=true
            DO_INSTALL=true
            ;;
        --clean)
            DO_CLEAN=true
            DO_INSTALL=true
            ;;
        --install)
            DO_INSTALL=true
            ;;
        --skip-dbsync)
            export SKIP_DBSYNC=true
            ;;
        --gulp-*)
            export GULP_TARGET="${!i:7}"
            ;;
        --skip-nginx)
            export SKIP_NGINX=true
            ;;
        --no-gulp-colors)
            export GULP_COLOR="--no-color"
            ;;
    esac
done


if [[ "$DO_CLEAN" == "true" ]]
then
  foreman run npm run clean
fi

if [[ "$DO_INSTALL" == "true" ]]
then
  foreman run npm install
fi

foreman run npm start
