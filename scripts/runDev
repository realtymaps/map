#!/bin/bash
set -e

for ((i=1; i<=$#; i++))
do
    case "${!i}" in
        --clean)
            DO_CLEAN=true
            DO_INSTALL=true
            ;;
        --install)
            DO_INSTALL=true
            ;;
        --skip-dbsync)
            export SKIP_DBSYNC=true
            ;;
        --bare-server)
            export BARE_EXPRESS_SERVER=true
            ;;
        --mayday)
            export MAYDAY_OPTS="-e .env-mayday"
            ;;
    esac
done


if [[ "$DO_CLEAN" == "true" ]]
then
  foreman run $MAYDAY_OPTS npm run clean
fi

if [[ "$DO_INSTALL" == "true" ]]
then
  foreman run $MAYDAY_OPTS npm install
fi

PATH=$PATH:node_modules/.bin foreman run $MAYDAY_OPTS ./scripts/app/startAppWrapper
