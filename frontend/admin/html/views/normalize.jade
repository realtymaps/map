.normalize-container

  .row.mls-select
    .col-md-3 Select MLS
      select(ng-model="mlsData.current" ng-options="value.name + ' (' + value.id + ')' for value in mlsConfigs" ng-change="selectMls()")
        option(value="" disabled)

    .col-md-3
      .row
        .col-md-12
          .col-md-4
            button(ng-click="dlCSV(csv.getUrl(csv.rowCount))" ng-disabled="!mlsData.current.id").btn.btn-primary.download-csv-button Download CSV
          .col-md-4
            input(type="text" ng-model="csv.rowCount" tooltip="Number of records in CSV" ng-disabled="!mlsData.current.id").form-control.download-csv-input
    .col-md-6

  .row.panel(cg-busy="mlsLoading" ng-show="mlsData.current")
    .col-md-2.list-container
      h4 Required
      .field-container(cg-busy="baseLoading")
        .field.base(
        ng-class="{ invalid: !item.valid }"
        ng-click="selectField(item)"
        ng-repeat="item in categories.base") {{item.alias}}

    .col-md-2.list-container
      h4 MLS
      .field-container(
      rmaps-droppable="categories.unassigned" on-drop="onDropCategory")
        .field(
        ng-class="{ 'assigned': item.assigned }"
        ng-click="selectField(item)"
        rmaps-draggable="item" rmaps-draggable-collection="categories.unassigned"
        ng-repeat="item in categories.unassigned") {{item.output}}
          span.datatype(ng-class="{ 'datatype-string': item.DataType == 'Character', \
           'datatype-number': item.Interpretation == 'Number', \
           'datatype-yn': item.DataType == 'Boolean', \
           'datatype-date': item.DataType == 'DateTime' }"
           ng-show="item.DataType || item.Interpretation")

    .col-md-8.list-container
      h4 Groups
      .field-container
        .category(
        rmaps-droppable="category.items" on-drop="onDropCategory"
        ng-repeat="category in targetCategories | filter:{label:'!base'} | filter:{label:'!unassigned'}") {{ category.label }}
          .field-list
            .field(
            ng-class="{ 'assigned': item.assigned, base: item.unselectable }"
            ng-click="item.unselectable || selectField(item)"
            rmaps-draggable="item" rmaps-draggable-collection="category.items"
            ng-repeat="item in category.items")
              span(ng-show="!item.unselectable") {{item.output}}
              span(ng-show="item.unselectable") {{item.alias}}
              span.datatype(ng-class="{ 'datatype-string': item.DataType == 'Character', \
               'datatype-number': item.Interpretation == 'Number', \
               'datatype-yn': item.DataType == 'Boolean', \
               'datatype-date': item.DataType == 'DateTime' }"
               ng-show="item.DataType || item.Interpretation")

  .row.panel.properties-container(cg-busy="fieldLoading" ng-show="showProperties")
    .close-icon(ng-click="showProperties=false") X
    .col-md-12(ng-show="fieldData.current.list != 'base'")
      h4 Field Validation
      .row
        .col-md-3 RETS Name:
        .col-md-9 {{fieldData.current.output}}
      .row
        .col-md-3 Data Type:
        .col-md-9 {{fieldData.current.type.label}}
      .row
        .col-md-3 Alias:
        .col-md-9
          input(type="text" ng-model="fieldData.current.config.alias" ng-change="updateRule()")
      div(ng-show="fieldData.current.Interpretation == 'Number'")
        .row
          .col-md-3 0 (zero) counts as null
          .col-md-3
            input(type="checkbox" ng-model="fieldData.current.config.nullZero" ng-change="updateRule()")
          .col-md-6
            Pick the right value!
        .row
          .col-md-3 Specific value counts as null
          .col-md-3
            input(type="text" ng-model="fieldData.current.config.nullNumber" placeholder="example: -1" ng-change="updateRule()")
          .col-md-6
            Pick the right value!
        .row(ng-show="fieldData.current.DataType == 'Decimal'")
          .col-md-3 Round / truncate decimal
          .col-md-3
            input(type="checkbox" ng-model="fieldData.current.config.floorDecimal" ng-change="updateRule()")
          .col-md-6
            Pick the right value!
      div(ng-show="fieldData.current.DataType == 'Character'")
        .row
          .col-md-3 Empty counts as null
          .col-md-9
            input(type="checkbox" ng-model="fieldData.current.config.nullEmpty" ng-change="updateRule()")
        .row
          .col-md-3 Specific value(s) count as null
          .col-md-9
            input(type="text" ng-model="fieldData.current.config.nullString" rmaps-list-input placeholder="no, false, n/a" ng-change="updateRule()")
        .row
          .col-md-3 Transform
          .col-md-9
            select(ng-model="fieldData.current.config.transformString" ng-options="v as k for (k, v) in transformOptions" ng-change="updateRule()")
              option(value="") None
        .row(ng-show="fieldData.current.lookups")
          .col-md-3 Replace values with RealtyMaps values (Lookup)
          .col-md-9(ng-if="fieldData.current.lookups.length > 50") There are {{fieldData.current.lookups.length}} lookups, too many to show!
        .row(ng-if="fieldData.current.lookups.length <= 50" ng-repeat="lookup in fieldData.current.lookups")
          .col-md-3 {{lookup.LongValue}}
          .col-md-9
            input(type="text" placeholder="Display value" ng-model="fieldData.current.config.choices[lookup.LongValue]" ng-change="updateRule()")
    .col-md-12(ng-show="fieldData.current.list == 'base'")
      h4 RealtyMaps {{fieldData.current.alias}}

      div(ng-show="fieldData.current.output == 'address'")
        div This field is shown to users within property details.
        .invalid-message(ng-show="!fieldData.current.valid") Select City and State. Select Zip or Zip+4. Select Full address or Street name + number.
        .field(ng-repeat="option in addressOptions"
          rmaps-droppable="option.key" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[option.key] }")
          span(ng-show="fieldData.current.input[option.key]") {{fieldData.current.input[option.key]}}:
          span {{option.label}}
          span.remove-icon(ng-show="fieldData.current.input[option.key]" ng-click="removeBaseInput(option.key)") X

      div(ng-show="fieldData.current.output == 'status_display'")
        div This field is shown to users within property details. MLS values may be replaced if they would be confusing.
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span {{fieldData.current.alias}}
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row(ng-repeat="lookup in fieldData.current.lookups")
          .col-md-3 {{lookup.LongValue}}
          .col-md-9
            input(type="text" placeholder="Display value" ng-model="fieldData.current.config.choices[lookup.LongValue]" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'status'")
        div This field is made available for filtering/searching.
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span {{fieldData.current.alias}}
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row(ng-repeat="lookup in fieldData.current.lookups")
          .col-md-3 {{lookup.LongValue}}
          .col-md-9
            select(ng-options="option for option in statusOptions" ng-model="fieldData.current.config.choices[lookup.LongValue]" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'substatus'")
        div This field is made available for filtering/searching.
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span {{fieldData.current.alias}}
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row(ng-repeat="lookup in fieldData.current.lookups")
          .col-md-3 {{lookup.LongValue}}
          .col-md-9
            select(ng-options="option for option in subStatusOptions" ng-model="fieldData.current.config.choices[lookup.LongValue]" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'days_on_market'")
        div If possible, select Cumulative Days on Market (CDOM) first, then Days on Market. Only one is required though.
        .field(rmaps-droppable="0" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[0] }")
          span(ng-show="fieldData.current.input[0]") {{fieldData.current.input[0]}}:
          span Cumulative Days on Market
          span.remove-icon(ng-show="fieldData.current.input[0]" ng-click="removeBaseInput(0)") X
        .field(rmaps-droppable="1" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[1] }")
          span(ng-show="fieldData.current.input[1]") {{fieldData.current.input[1]}}:
          span Days on Market
          span.remove-icon(ng-show="fieldData.current.input[1]" ng-click="removeBaseInput(1)") X

      div(ng-show="fieldData.current.output == 'parcel_id'")
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span Parcel ID
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row
          .col-md-3 Strip Formatting
          .col-md-3
            input(type="checkbox" ng-model="fieldData.current.config.stripFormatting" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'hide_address'")
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span Hide Listing
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row
          .col-md-3 Invert
          .col-md-3
            input(type="checkbox" ng-model="fieldData.current.config.invert" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'hide_listing'")
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span Hide Listing
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X
        .row
          .col-md-3 Invert
          .col-md-3
            input(type="checkbox" ng-model="fieldData.current.config.invert" ng-change="updateRule()")

      div(ng-show="fieldData.current.output == 'fips_code'")
        .field(rmaps-droppable="0" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[0] }")
          span(ng-show="fieldData.current.input[0]") {{fieldData.current.input[0]}}:
          span County
          span.remove-icon(ng-show="fieldData.current.input[0]" ng-click="removeBaseInput(0)") X
        .field(rmaps-droppable="1" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[1] }")
          span(ng-show="fieldData.current.input[1]") {{fieldData.current.input[1]}}:
          span State
          span.remove-icon(ng-show="fieldData.current.input[1]" ng-click="removeBaseInput(1)") X

      div(ng-show="fieldData.current.output == 'rm_property_id'")
        .field(rmaps-droppable="0" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[0] }")
          span(ng-show="fieldData.current.input[0]") {{fieldData.current.input[0]}}:
          span County
          span.remove-icon(ng-show="fieldData.current.input[0]" ng-click="removeBaseInput(0)") X
        .field(rmaps-droppable="1" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[1] }")
          span(ng-show="fieldData.current.input[1]") {{fieldData.current.input[1]}}:
          span State
          span.remove-icon(ng-show="fieldData.current.input[1]" ng-click="removeBaseInput(1)") X
        .field(rmaps-droppable="2" on-drop="onDropBaseInput" ng-class="{ empty: !fieldData.current.input[2] }")
          span(ng-show="fieldData.current.input[2]") {{fieldData.current.input[2]}}:
          span Parcel
          span.remove-icon(ng-show="fieldData.current.input[2]" ng-click="removeBaseInput(2)") X

      //- Generic
      div(ng-show="['price', 'acres', 'baths_full', 'bedrooms', 'price', 'sqft_finished', 'close_date', 'discontinued_date'].indexOf(fieldData.current.output) != -1")
        .field(rmaps-droppable="'input'" on-drop="onDropBase" ng-class="{ empty: !fieldData.current.input }")
          span(ng-show="fieldData.current.input") {{fieldData.current.input}}:
          span {{fieldData.current.alias}}
          span.remove-icon(ng-show="fieldData.current.input" ng-click="removeBase()") X

    .col-md-12
      h4 Field Transform
      .row
        .col-md-3 Enable editing (advanced)
        .col-md-9
          input(type="checkbox" ng-model="fieldData.current.advanced" ng-change="updateRule()")
      .row
        .col-md-12
          textarea.transform(ng-model="fieldData.current.transform" ng-disabled="!fieldData.current.advanced")

