extends ../_layout

block customHead
  //TODO: angular-stripe, stripe-promisified, all expect Stipe to be loaded into DOM immediatley
  // to much of a PAIN to refactor
  script(type='application/javascript' src="https://js.stripe.com/v2/")
  script.
    function addScript( url, callback ) {
      var script = document.createElement( 'script' );
      if(callback)
        script.onload = callback;
      script.type = 'text/javascript';
      script.src = location.protocol + url;
      document.body.appendChild(script);  
    } 
    function loadAsyncScripts() {
        addScript("!{google.mapsSdkUrl}&callback=mapsApiReady");
        window.removeEventListener('load', loadAsyncScripts);
    }
    function mapsApiReady() {
      console.log('GOOGLE LOADED');
    }
    
    window.addEventListener('load', loadAsyncScripts);

  title RealtyMaps
  meta(name='description' content='RealtyMaps')


block content
  link(rel='stylesheet' href='styles/map.css')
  .realtymaps-main(ui-view='' ng-controller="rmapsAppCtrl" ng-class="{ 'is-subscriber': principal.isSubscriber(), 'is-editor': principal.isProjectEditor(), 'is-viewer': principal.isProjectViewer() }")
  script(type='application/javascript' src='#{paths.destFull.bundle.map}')
  script(type='application/javascript' src='#{paths.destFull.templates.map}')
